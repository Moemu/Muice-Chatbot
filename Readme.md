![](src/Cover.png)
<p style="text-align:center">
<img src="https://img.shields.io/github/stars/Moemu/Muice-Chatbot" alt="Stars">
<img src="https://img.shields.io/badge/Model-ChatGLM2--6B & Qwen--7B-green" alt="Model">
<img src="https://img.shields.io/badge/HuggingFace-Dataset-yellow?link=https%3A%2F%2Fhuggingface.co%2Fdatasets%2FMoemu%2FMuice-Dataset" alt="HuggingFace">
<img src="https://img.shields.io/badge/Python-3.10-blue" alt="Python">
</p>


# ä»‹ç»âœ¨

æ²é›ªï¼Œä¸€åªä¼š**ä¸»åŠ¨**æ‰¾ä½ èŠå¤©çš„ AI å¥³å­©å­ï¼Œå…¶å¯¹è¯æ¨¡å‹åŸºäº [ChatGLM2-6B](https://github.com/THUDM/ChatGLM2-6B) ä¸ [Qwen](https://github.com/QwenLM) å¾®è°ƒè€Œæˆï¼Œè®­ç»ƒé›†ä½“é‡ 3k+ ï¼Œå…·æœ‰äºŒæ¬¡å…ƒå¥³å­©å­çš„è¯´è¯é£æ ¼ï¼Œæ¯”è¾ƒå‚²å¨‡ï¼Œä½†ä¹äºå’Œä½ åˆ†äº«ç”Ÿæ´»çš„çç¢ï¼Œæ¯å¤©ä¼šç»™ä½ ä¸ä¸€æ ·çš„é—®å€™ã€‚

# åŠŸèƒ½ğŸª„

âœ… æ”¯æŒè¿‘ä¹å…¨è‡ªåŠ¨å®‰è£…ç¯å¢ƒ

âœ… æä¾›æœ¬äººç”± 3k+ å¯¹è¯æ•°æ®å¾®è°ƒçš„ ChatGLM2-6B P-Tuning V2 æ¨¡å‹ä¸ Qwen Qlora å¾®è°ƒæ¨¡å‹	

âœ… ä¸»åŠ¨å‘èµ·èŠå¤©ï¼ˆéšæœºå’Œæ¯å¤©æ—©ä¸­æ™šå›ºå®šæ—¶é—´ï¼‰

âœ… æä¾› 5 æ¡å‘½ä»¤ä»¥ä¾¿åœ¨èŠå¤©ä¸­è¿›è¡Œåˆ·æ–°å›å¤ç­‰æ“ä½œ

âœ… OFA å›¾åƒè¯†åˆ«ï¼šè¯†åˆ«è¡¨æƒ…åŒ…ã€ç†è§£è¡¨æƒ…åŒ…ã€å‘é€è¡¨æƒ…åŒ…

âœ… æ”¯æŒé€šè¿‡ [fishaudio/fish-speech](https://github.com/fishaudio/fish-speech) è¿›è¡Œè¯­è¨€åˆæˆï¼ˆæ²é›ª TTS æ¨¡å‹å°šæœªå‘å¸ƒï¼‰

âœ… åœ¨ç¾¤èŠä¸­èŠå¤©ï¼ˆæ”¯æŒè¢« @ å›å¤æˆ–ä¸è¢« @ éšæœºå›å¤ï¼‰

âœ… åœ¨æ§åˆ¶å°ä¸­å®æ—¶å¯¹è¯ï¼ˆæš‚ä¸æ”¯æŒæ‰“ QQ è¯­éŸ³ï¼‰

â¬œ å¯¹è®°å¿†æ¨¡å—è¿›è¡Œä¼˜åŒ–ï¼Œå®ç°é•¿æœŸè®°å¿†ä¸çŸ­æœŸè®°å¿†

â¬œ å®Œå–„æ—¥å¿—è®°å½•æœºåˆ¶ï¼Œå®ç°è‡ªåŠ¨ç”Ÿæˆ bug æŠ¥å‘Š

â¬œ å»ºç«‹å¸¸è§ Q&A æŒ‡å—

â¬œ æä¾›å¤šè¯­è¨€æ–‡æ¡£


# å¿«é€Ÿå¼€å§‹ğŸ’»

å»ºè®®ç¯å¢ƒï¼š

- Python 3.10+
- ä¸€å¼ æ‹¥æœ‰ 6GB åŠä»¥ä¸Šæ˜¾å­˜çš„æ˜¾å¡ï¼ˆint4 é‡åŒ–æœ€ä½è¦æ±‚ä¸º 4G æ˜¾å­˜ï¼ŒCPU æ¨ç†éœ€è¦ 16G åŠä»¥ä¸Šå†…å­˜ï¼‰

## è‡ªåŠ¨å®‰è£…

ç›®å‰å·²åšåˆ°è‡ªåŠ¨å®‰è£…æ‰€æœ‰è½¯ä»¶ã€ä¾èµ–ï¼Œé€šè¿‡ `Code -> Download ZIP` ä¸‹è½½è§£å‹æœ€æ–°æºç ã€‚

åŒå‡» `install_env.bat` å®‰è£…ï¼ˆ**ä¸èƒ½å¯ç”¨æ—§ç‰ˆæ§åˆ¶å°**ï¼‰ï¼Œæˆ–åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```powershell
.\install_env.bat
```

è‡ªåŠ¨å®‰è£…å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…ï¼Œå®‰è£…å®Œæˆåï¼Œä½ ä»éœ€æ‰‹åŠ¨ä¸‹è½½æ¨¡å‹ã€‚

**è‡ªåŠ¨å®‰è£…è„šæœ¬ä½¿ç”¨çš„æ˜¯ Python è™šæ‹Ÿç¯å¢ƒï¼Œä¸éœ€è¦ Condaï¼Œè¯·ç•™æ„å®‰è£…è„šæœ¬çš„æç¤ºã€‚**

## æ‰‹åŠ¨å®‰è£…ï¼ˆä½¿ç”¨ Condaï¼‰

```powershell
git clone https://github.com/Moemu/Muice-Chatbot
cd Muice-Chatbot
conda create --name Muice python=3.10.10 -y
conda activate Muice
pip install -r requirements.txt -i https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple
```

å¯¹äº GPU ç”¨æˆ·ï¼Œè¯·é¢å¤–æ‰§è¡Œ

```powershell
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu124
```

## æ¨¡å‹ä¸‹è½½å’ŒåŠ è½½

ç›®å‰æ”¯æŒçš„åŸºåº•æ¨¡å‹å¦‚ä¸‹è¡¨ï¼š

| åŸºåº•æ¨¡å‹                                                     | å¯¹åº”å¾®è°ƒæ¨¡å‹ç‰ˆæœ¬å·                         | é¢å¤–ä¾èµ–åº“                  |
| ------------------------------------------------------------ | ------------------------------------------ | --------------------------- |
| [ChatGLM2-6B-Int4](https://www.modelscope.cn/models/ZhipuAI/chatglm2-6b-int4/summary) | 2.2-2.4                                    | cpm_kernels                 |
| [ChatGLM2-6B](https://www.modelscope.cn/models/ZhipuAI/chatglm2-6b/summary) | 2.0-2.3                                    |                             |
| [Qwen-7B-Chat-Int4](https://www.modelscope.cn/models/qwen/Qwen-7B-Chat-Int4/summary) | 2.3ã€2.6.2                                 | llmtuner                    |
| [Qwen2-1.5B-Instruct-GPTQ-Int4](https://www.modelscope.cn/models/qwen/Qwen2-1.5B-Instruct-GPTQ-Int4/summary) | 2.5.3                                      | llmtuner                    |
| [RWKV(Seikaijyuå¾®è°ƒ)](https://huggingface.co/Seikaijyu)      | å‚è§ [HF](https://huggingface.co/Seikaijyu) | ï¼ˆéœ€è¦ä¸‹è½½é…ç½® RWKV-Runnerï¼‰ |

å¾®è°ƒæ¨¡å‹ä¸‹è½½ï¼š[Releases](https://github.com/Moemu/Muice-Chatbot/releases)

è¯·å°†åŸºåº•æ¨¡å‹ä¸å¾®è°ƒæ¨¡å‹æ”¾å…¥ `model` æ–‡ä»¶å¤¹ä¸­ï¼ˆç¡®ä¿å¾®è°ƒæ¨¡å‹ç›®å½•ä¸‹å­˜åœ¨ `.model` æ–‡ä»¶è€Œä¸æ˜¯æ–‡ä»¶å¤¹ï¼Œéƒ¨åˆ†å¾®è°ƒæ¨¡å‹ç”±äºç–å¿½è¿˜å¥—äº†ä¸€å±‚ `checkpoint` æ–‡ä»¶å¤¹ï¼‰

æœ¬ä»“åº“ç›®å‰æ”¯æŒå¦‚ä¸‹æ¨¡å‹åŠ è½½æ–¹å¼ï¼š

1. é€šè¿‡ API åŠ è½½
2. é€šè¿‡ `transformers` çš„`AutoTokenizer`, `AutoModel` å‡½æ•°åŠ è½½
3. é€šè¿‡`llmtuner.chat`ï¼ˆ`LLaMA-Factory`ï¼‰çš„ `ChatModel` ç±»åŠ è½½
4. é€šè¿‡ `RWKV-Runner` æä¾›çš„ API æœåŠ¡åŠ è½½

åœ¨å·²æµ‹è¯•çš„æ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬å»ºè®®ä»¥ä¸‹æ¨¡å‹é€šè¿‡å¯¹åº”çš„æ–¹å¼åŠ è½½ï¼Œå…¶ä»–æ¨¡å‹äº¦å¯ä»¥é€šè¿‡ç±»ä¼¼çš„æ–¹å¼åŠ è½½ï¼š

| åŸºåº•æ¨¡å‹              | å¾®è°ƒæ–¹å¼        | åŠ è½½æ–¹æ³•         |
|-------------------|-------------|--------------|
| ChatGLM           | P-tuning V2 | transformers |
| Qwen              | sft         | llmtuner     |
| RWKVï¼ˆSeikaijyu å¾®è°ƒï¼‰ | pissa       | rwkv-api     |

åœ¨é…ç½®æ–‡ä»¶ä¸­å¯è°ƒæ•´æ¨¡å‹çš„åŠ è½½æ–¹å¼ï¼š

```json
"model_loader": "api/transformers/llmtuner/rwkv-api",
"model_name_or_path": "<åŸºåº•æ¨¡å‹ä½ç½®>",
"adapter_name_or_path": "<æ²é›ªå¾®è°ƒæ¨¡å‹ä½ç½®>"
```

ï¼ˆè‹¥æ˜¯ API / rwkv-api åŠ è½½ï¼Œ`model_name_or_path` å¡«å†™å¯¹åº”çš„ API åœ°å€ï¼‰

å¦‚æœä½ æ²¡æœ‰åˆé€‚çš„æ˜¾å¡ï¼Œéœ€è¦é€šè¿‡ CPU åŠ è½½æ¨¡å‹ï¼Œè¯·å®‰è£…å¹¶é…ç½® `GCC` ç¯å¢ƒï¼Œç„¶åå‹¾é€‰ `openmp`ã€‚[å‚è€ƒé“¾æ¥](https://blog.csdn.net/m0_52985087/article/details/136480206?spm=1001.2014.3001.5501)

## Bot æœåŠ¡é…ç½®

ç°ä»¥æä¾› OneBot æœåŠ¡æ”¯æŒ, æ— éœ€æ‹…å¿ƒ gocq çš„é£æ§(å–œ)

æœ¬é¡¹ç›®ä½¿ç”¨ [OneBot V11](https://github.com/botuniverse/onebot-11) åè®®, è‹¥æ‚¨å¸Œæœ›äº QQ ä½¿ç”¨, æ¨èå‚è€ƒ [LLOneBot](https://github.com/LLOneBot/LLOneBot) ä½¿ç”¨ OneBot æœåŠ¡

æ³¨ï¼šè¯·åœ¨å®‰è£…å¥½ LLOneBot å, äºè®¾ç½®ä¸­å¼€å¯åå‘ WebSocket æœåŠ¡, å¡«å†™ `ws://127.0.0.1:21050/ws/api`, ä»¥æ­£å¸¸è¿è¡Œ

æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ [Lagrange.Core](https://github.com/LagrangeDev/Lagrange.Core) ä»¥åŠ [~~OpenShamrock~~](https://github.com/whitechi73/OpenShamrock) ç­‰æ¥é“¾æ¥QQ, æˆ–å…¶ä»–é€‚é…å™¨é“¾æ¥å…¶ä»–è½¯ä»¶ï¼Œè¯¦è§ [OneBot V11 é€‚é…å™¨](https://onebot.dev/ecosystem.html#onebot-%E5%AE%9E%E7%8E%B0-1)

**èƒ½ä½¿ç”¨è¯·å‹¿éšæ„æ›´æ–° QQNT, è‹¥æ— æ³•ä½¿ç”¨è¯·å°è¯•é™çº§ QQNT**

## å…¶ä»–åŠŸèƒ½

- [è¯­éŸ³å›å¤](docs/other_func.md#è¯­éŸ³å›å¤)
- [å›¾åƒè¯†åˆ«ï¼ˆè¯†åˆ« / å‘é€è¡¨æƒ…åŒ…ï¼‰](docs/other_func.md##ofa-å›¾åƒè¯†åˆ«è¯†åˆ«--å‘é€è¡¨æƒ…åŒ…)
- [Faiss é•¿æœŸè®°å¿†](docs/other_func.md#faiss-é•¿æœŸè®°å¿†å®éªŒæ€§å†…å®¹)
- [å®æ—¶è¯­éŸ³èŠå¤©](docs/other_func.md#å¯åŠ¨å®æ—¶è¯­éŸ³èŠå¤©)

## æ€»ç»“

åœ¨å®Œæˆè¿™äº›æ“ä½œåï¼Œä½ åº”è¯¥å¾—åˆ°ç±»ä¼¼å¦‚ä¸‹æ‰€ç¤ºçš„æ–‡ä»¶ç»“æ„ï¼š


```
Muice-Chatbot     <- ä¸»è·¯å¾„
 â”œâ”€llm
 â”œâ”€model
 â”‚  â”œâ”€ chatglm2-6b       <- åŸå§‹æ¨¡å‹ (ä¸‰è€…ä¸‰é€‰ä¸€)
 â”‚  â”œâ”€ chatglm2-6b-int4  <- int4åŸå§‹æ¨¡å‹
 â”‚  â”œâ”€ Qwen-7B-Chat-Int4 <- Qwen-7B-int4åŸå§‹æ¨¡å‹
 â”‚  â””â”€ Muice
 â”œâ”€configs.json  <- é…ç½®æ–‡ä»¶
 â”œâ”€ws.py         <- wsæœåŠ¡
 â”œâ”€main.py       <- ä¸»å‡½æ•°
 â”œâ”€requirements.txt
 â””â”€...
```

# é…ç½®âš’ï¸

é…ç½®æ–‡ä»¶ä½äº `config.json`ï¼Œè¯·æ ¹æ®ä½ çš„éœ€æ±‚è¿›è¡Œä¿®æ”¹ï¼ˆå…·ä½“å‚è€ƒ[é…ç½®è¯´æ˜](docs/config.md)ï¼‰ã€‚

ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨`configuration_gui.py`å›¾å½¢åŒ–ç•Œé¢é…ç½®æ–‡ä»¶ã€‚

```powershell
python configuration_gui.py
```

# ä½¿ç”¨ğŸ‰

åœ¨æœ¬é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œ `main.py`

```powershell
conda activate Muice
python main.py
```

æˆ–æ˜¯è¿è¡Œè‡ªåŠ¨å®‰è£…è„šæœ¬ç”Ÿæˆçš„å¯åŠ¨è„šæœ¬`start.bat`

# å‘½ä»¤ğŸ•¹ï¸

| å‘½ä»¤       | é‡Šä¹‰                |
|----------|-------------------|
| /clean   | æ¸…ç©ºæœ¬è½®å¯¹è¯å†å²          |
| /refresh | åˆ·æ–°æœ¬æ¬¡å¯¹è¯            |
| /help    | æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨çš„å‘½ä»¤åˆ—è¡¨       |
| /reset   | é‡ç½®æ‰€æœ‰å¯¹è¯æ•°æ®(å°†å­˜æ¡£å¯¹è¯æ•°æ®) |
| /undo    | æ’¤é”€ä¸Šä¸€æ¬¡å¯¹è¯           |

# ç¤ºä¾‹å¯¹è¯ï¼ˆè®­ç»ƒé›†ï¼‰ğŸ“‘

å‚è§å…¬å¼€çš„è®­ç»ƒé›† [Moemu/Muice-Dataset](https://huggingface.co/datasets/Moemu/Muice-Dataset)

# æ²é›ªäººè®¾

ä¸å…¶ä»–èŠå¤©æœºå™¨äººé¡¹ç›®ä¸åŒï¼Œæœ¬é¡¹ç›®æä¾›ç”±æœ¬äººé€šè¿‡è‡ªå®¶å¯¹è¯æ•°æ®é›†å¾®è°ƒåçš„æ¨¡å‹ï¼Œåœ¨ Release ä¸­æä¾›ä¸‹è½½ï¼Œå…³äºå¾®è°ƒåçš„æ¨¡å‹äººè®¾ï¼Œç›®å‰å…¬å¼€çš„ä¿¡æ¯å¦‚ä¸‹ï¼š

![æ²é›ªäººè®¾å›¾ï¼ˆè‹¥æ— æ³•æ‰“å¼€è¯·é€šè¿‡å³é”®æ‰“å¼€ï¼‰](https://i0.hdslb.com/bfs/new_dyn/9fc79347b54c5f2835884c8f755bd1ea97020216.png)

è®­ç»ƒé›†å¼€æºåœ°å€ï¼š [Moemu/Muice-Dataset](https://huggingface.co/datasets/Moemu/Muice-Dataset)

åŸå§‹æ¨¡å‹ï¼š[THUDM/ChatGLM2-6B](https://github.com/THUDM/ChatGLM2-6B) & [QwenLM/Qwen](https://github.com/QwenLM/Qwen)ï¼‰

æœ¬é¡¹ç›®æºç ä½¿ç”¨ [MIT License](https://github.com/Moemu/Muice-Chatbot/blob/main/LICENSE)ï¼Œå¯¹äºå¾®è°ƒåçš„æ¨¡å‹æ–‡ä»¶ï¼Œä¸å»ºè®®å°†å…¶ä½œä¸ºå•†ä¸šç”¨é€”

# å…³äºğŸ—ï¸

ä»£ç å®ç°ï¼š[Moemu](https://github.com/Moemu)ã€[MoeSnowyFox](https://github.com/MoeSnowyFox)ã€[NaivG](https://github.com/NaivG)ã€[zkhssb](https://github.com/zkhssb)

è®­ç»ƒé›†ç¼–å†™ä¸æ¨¡å‹å¾®è°ƒï¼š[Moemu](https://github.com/Moemu) ï¼ˆRWKV å¾®è°ƒï¼š[Seikaijyu](https://github.com/Seikaijyu)ï¼‰

å¸®åŠ©æ–‡æ¡£ç¼–å†™ï¼š[TurboHK](https://github.com/TurboHK)ã€[å¶å­](https://github.com/FHU-yezi)

> å‹æƒ…è¿æ¥ï¼š[Coral æ¡†æ¶](https://github.com/ProjectCoral/Coral)

æ€»ä»£ç è´¡çŒ®ï¼š

<a href="https://github.com/eryajf/Moemu/Muice-Chatbot/contributors">
  <img src="https://contrib.rocks/image?repo=Moemu/Muice-Chatbot"  alt="å›¾ç‰‡åŠ è½½ä¸­..."/>
</a>

å¦‚æœæ­¤é¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ‚¨å¯ä»¥è€ƒè™‘èµåŠ©ã€‚æŒ‰ç…§æ²é›ªèµåŠ©ä½¿ç”¨æ–¹æ³•ï¼Œæ‰€æœ‰æ”¶å…¥å°†æŠ½å–20%ç”¨äºæ…ˆå–„äº‹ä¸šï¼ˆæä¾›è¯ä¹¦ï¼‰ã€‚

<a href="https://www.buymeacoffee.com/Moemu" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height: 45px !important;width: 163px !important;" ></a>

æ„Ÿè°¢ä½ ä»¬æ‰€æœ‰äººçš„æ”¯æŒï¼æ— è®ºä½ æ˜¯å¦èµåŠ©å’Œè´¡çŒ®ä»£ç ï¼

Star Historyï¼š

[![Star History Chart](https://api.star-history.com/svg?repos=Moemu/Muice-Chatbot&type=Date)](https://star-history.com/#Moemu/Muice-Chatbot&Date)

